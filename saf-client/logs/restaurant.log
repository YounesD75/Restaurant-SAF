2025-12-25 13:39:33.491 [main] INFO  [c.s.client.SafClientApplicationTests] [Actor:] - Starting SafClientApplicationTests using Java 21.0.7 with PID 43467 (started by cytech in /home/cytech/Restaurant-SAF/saf-client)
2025-12-25 13:39:33.500 [main] INFO  [c.s.client.SafClientApplicationTests] [Actor:] - No active profile set, falling back to 1 default profile: "default"
2025-12-25 13:39:34.950 [main] INFO  [com.saf.core1.LocalActorSystem] [Actor:] - SAF ActorSystem started with 12 threads.
2025-12-25 13:39:34.962 [main] INFO  [com.saf.core1.router.RoundRobinPool] [Actor:client-router-2d0f265c-e50f-47ff-9030-6546904aa48b] - Starting Router Pool with 3 initial workers.
2025-12-25 13:39:37.367 [main] WARN  [o.s.c.l.c.LoadBalancerCacheAutoConfiguration$LoadBalancerCaffeineWarnLogger] [Actor:] - Spring Cloud LoadBalancer is currently working with the default cache. While this cache implementation is useful for development and tests, it's recommended to use Caffeine cache in production.You can switch to using Caffeine cache, by adding it and org.springframework.cache.caffeine.CaffeineCacheManager to the classpath.
2025-12-25 13:39:37.453 [main] INFO  [c.s.client.SafClientApplicationTests] [Actor:] - Started SafClientApplicationTests in 4.313 seconds (process running for 5.005)
2025-12-25 13:39:38.200 [main] INFO  [c.s.c.ClientProxyIntegrationTest] [Actor:] - Starting ClientProxyIntegrationTest using Java 21.0.7 with PID 43467 (started by cytech in /home/cytech/Restaurant-SAF/saf-client)
2025-12-25 13:39:38.201 [main] INFO  [c.s.c.ClientProxyIntegrationTest] [Actor:] - No active profile set, falling back to 1 default profile: "default"
2025-12-25 13:39:38.812 [main] INFO  [com.saf.core1.LocalActorSystem] [Actor:] - SAF ActorSystem started with 12 threads.
2025-12-25 13:39:38.814 [main] INFO  [com.saf.core1.router.RoundRobinPool] [Actor:client-router-8d6dd81d-3432-446a-a0ba-1d772e4936b3] - Starting Router Pool with 3 initial workers.
2025-12-25 13:39:39.646 [main] WARN  [o.s.c.l.c.LoadBalancerCacheAutoConfiguration$LoadBalancerCaffeineWarnLogger] [Actor:] - Spring Cloud LoadBalancer is currently working with the default cache. While this cache implementation is useful for development and tests, it's recommended to use Caffeine cache in production.You can switch to using Caffeine cache, by adding it and org.springframework.cache.caffeine.CaffeineCacheManager to the classpath.
2025-12-25 13:39:39.833 [main] INFO  [c.s.c.ClientProxyIntegrationTest] [Actor:] - Started ClientProxyIntegrationTest in 1.669 seconds (process running for 7.385)
2025-12-25 13:39:39.986 [pool-6-thread-1] INFO  [com.saf.core1.ActorCell] [Actor:client-router-8d6dd81d-3432-446a-a0ba-1d772e4936b3] - RECEIVED message [ProxyCall] Payload: GET /client/menu
2025-12-25 13:39:39.987 [pool-6-thread-1] INFO  [com.saf.core1.router.RoundRobinPool] [Actor:] - Pool size is now: 3
2025-12-25 13:39:39.988 [pool-6-thread-2] INFO  [com.saf.core1.ActorCell] [Actor:worker-0-ef6f0d5f-6677-4469-ad2b-644b906d9e2e] - RECEIVED message [ProxyCall] Payload: GET /client/menu
2025-12-25 13:39:39.988 [pool-6-thread-2] INFO  [com.saf.client.ClientGatewayActor] [Actor:worker-0-ef6f0d5f-6677-4469-ad2b-644b906d9e2e] - Proxy call received: GET /client/menu
2025-12-25 13:39:40.158 [pool-6-thread-1] INFO  [com.saf.core1.ActorCell] [Actor:] - RECEIVED message [ProxyCall] Payload: POST /client/orders
2025-12-25 13:39:40.158 [pool-6-thread-3] INFO  [com.saf.core1.ActorCell] [Actor:worker-1-5cd91570-36c5-43ac-b2d7-cfdd52c34aad] - RECEIVED message [ProxyCall] Payload: POST /client/orders
2025-12-25 13:39:40.158 [pool-6-thread-3] INFO  [com.saf.client.ClientGatewayActor] [Actor:worker-1-5cd91570-36c5-43ac-b2d7-cfdd52c34aad] - Proxy call received: POST /client/orders
2025-12-25 13:39:46.201 [main] INFO  [com.zaxxer.hikari.HikariDataSource] [Actor:] - HikariPool-1 - Starting...
2025-12-25 13:39:46.232 [main] INFO  [com.zaxxer.hikari.pool.HikariPool] [Actor:] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@52ab003b
2025-12-25 13:39:46.235 [main] INFO  [com.zaxxer.hikari.HikariDataSource] [Actor:] - HikariPool-1 - Start completed.
2025-12-25 13:39:46.313 [main] INFO  [o.f.c.i.license.VersionPrinter] [Actor:] - Flyway Community Edition 9.22.3 by Redgate
2025-12-25 13:39:46.314 [main] INFO  [o.f.c.i.license.VersionPrinter] [Actor:] - See release notes here: https://rd.gt/416ObMi
2025-12-25 13:39:46.314 [main] INFO  [o.f.c.i.license.VersionPrinter] [Actor:] - 
2025-12-25 13:39:46.323 [main] INFO  [org.flywaydb.core.FlywayExecutor] [Actor:] - Database: jdbc:postgresql://localhost:32769/inventory_db (PostgreSQL 15.15)
2025-12-25 13:39:46.352 [main] INFO  [o.f.c.i.s.JdbcTableSchemaHistory] [Actor:] - Schema history table "public"."flyway_schema_history" does not exist yet
2025-12-25 13:39:46.357 [main] INFO  [o.f.core.internal.command.DbValidate] [Actor:] - Successfully validated 2 migrations (execution time 00:00.013s)
2025-12-25 13:39:46.372 [main] INFO  [o.f.c.i.s.JdbcTableSchemaHistory] [Actor:] - Creating Schema History table "public"."flyway_schema_history" ...
2025-12-25 13:39:46.398 [main] INFO  [o.f.core.internal.command.DbMigrate] [Actor:] - Current version of schema "public": << Empty Schema >>
2025-12-25 13:39:46.406 [main] INFO  [o.f.core.internal.command.DbMigrate] [Actor:] - Migrating schema "public" to version "1 - init inventory tables"
2025-12-25 13:39:46.425 [main] INFO  [o.f.core.internal.command.DbMigrate] [Actor:] - Migrating schema "public" to version "2 - seed inventory data"
2025-12-25 13:39:46.443 [main] INFO  [o.f.core.internal.command.DbMigrate] [Actor:] - Successfully applied 2 migrations to schema "public", now at version v2 (execution time 00:00.019s)
2025-12-25 13:39:48.013 [main] INFO  [com.saf.core1.LocalActorSystem] [Actor:] - SAF ActorSystem started with 12 threads.
2025-12-25 13:39:48.021 [main] INFO  [com.saf.core1.router.RoundRobinPool] [Actor:stock-router-e5238651-77d2-4c8e-8c5a-8d073564b27d] - Starting Router Pool with 3 initial workers.
2025-12-25 13:39:48.147 [main] WARN  [o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration] [Actor:] - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-12-25 13:39:49.818 [main] INFO  [com.zaxxer.hikari.HikariDataSource] [Actor:] - HikariPool-2 - Starting...
2025-12-25 13:39:49.827 [main] INFO  [com.zaxxer.hikari.pool.HikariPool] [Actor:] - HikariPool-2 - Added connection org.postgresql.jdbc.PgConnection@3097f11f
2025-12-25 13:39:49.827 [main] INFO  [com.zaxxer.hikari.HikariDataSource] [Actor:] - HikariPool-2 - Start completed.
2025-12-25 13:39:49.845 [main] INFO  [org.flywaydb.core.FlywayExecutor] [Actor:] - Database: jdbc:postgresql://localhost:32769/saf_restaurant (PostgreSQL 15.15)
2025-12-25 13:39:49.851 [main] INFO  [o.f.c.i.s.JdbcTableSchemaHistory] [Actor:] - Schema history table "public"."flyway_schema_history" does not exist yet
2025-12-25 13:39:49.852 [main] INFO  [o.f.core.internal.command.DbValidate] [Actor:] - Successfully validated 2 migrations (execution time 00:00.002s)
2025-12-25 13:39:49.858 [main] INFO  [o.f.c.i.s.JdbcTableSchemaHistory] [Actor:] - Creating Schema History table "public"."flyway_schema_history" ...
2025-12-25 13:39:49.875 [main] INFO  [o.f.core.internal.command.DbMigrate] [Actor:] - Current version of schema "public": << Empty Schema >>
2025-12-25 13:39:49.877 [main] INFO  [o.f.core.internal.command.DbMigrate] [Actor:] - Migrating schema "public" to version "1 - init inventory tables"
2025-12-25 13:39:49.891 [main] INFO  [o.f.core.internal.command.DbMigrate] [Actor:] - Migrating schema "public" to version "2 - seed inventory data"
2025-12-25 13:39:49.901 [main] INFO  [o.f.core.internal.command.DbMigrate] [Actor:] - Successfully applied 2 migrations to schema "public", now at version v2 (execution time 00:00.014s)
2025-12-25 13:39:50.035 [main] WARN  [o.h.e.jdbc.spi.SqlExceptionHelper] [Actor:] - SQL Warning Code: 0, SQLState: 00000
2025-12-25 13:39:50.036 [main] WARN  [o.h.e.jdbc.spi.SqlExceptionHelper] [Actor:] - constraint "uk_oq3k6lov98v737betmc0gna0f" of relation "receipts" does not exist, skipping
2025-12-25 13:39:50.038 [main] WARN  [o.h.e.jdbc.spi.SqlExceptionHelper] [Actor:] - SQL Warning Code: 0, SQLState: 00000
2025-12-25 13:39:50.038 [main] WARN  [o.h.e.jdbc.spi.SqlExceptionHelper] [Actor:] - constraint "uk_604j9lgnslnhffkb9atk5van2" of relation "treasury_entries" does not exist, skipping
2025-12-25 13:39:50.052 [main] INFO  [com.saf.core1.LocalActorSystem] [Actor:] - SAF ActorSystem started with 12 threads.
2025-12-25 13:39:50.054 [main] INFO  [com.saf.core1.router.RoundRobinPool] [Actor:menu-router-27144093-f059-43e8-884f-ed3b8052ce1c] - Starting Router Pool with 3 initial workers.
2025-12-25 13:39:50.522 [main] WARN  [o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration] [Actor:] - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-12-25 13:39:51.280 [pool-6-thread-4] INFO  [com.saf.core1.ActorCell] [Actor:restaurant-377a3a09-f2d9-415a-8155-97a6e606c55a] - RECEIVED message [PurgeStaleOrders] Payload: 1766666361279
2025-12-25 13:39:51.897 [main] INFO  [com.saf.core1.LocalActorSystem] [Actor:] - SAF ActorSystem started with 12 threads.
2025-12-25 13:39:51.899 [main] INFO  [com.saf.core1.router.RoundRobinPool] [Actor:client-router-45ec8bd2-accd-4613-9b14-02060bc78695] - Starting Router Pool with 3 initial workers.
2025-12-25 13:39:55.007 [pool-9-thread-1] INFO  [com.saf.core1.ActorCell] [Actor:client-router-45ec8bd2-accd-4613-9b14-02060bc78695] - RECEIVED message [ProxyCall] Payload: GET /client/menu
2025-12-25 13:39:55.008 [pool-9-thread-1] INFO  [com.saf.core1.router.RoundRobinPool] [Actor:] - Pool size is now: 3
2025-12-25 13:39:55.008 [pool-9-thread-2] INFO  [com.saf.core1.ActorCell] [Actor:worker-0-99edd64a-0fbf-4cda-a419-7d58a01bcbad] - RECEIVED message [ProxyCall] Payload: GET /client/menu
2025-12-25 13:39:55.008 [pool-9-thread-2] INFO  [com.saf.client.ClientGatewayActor] [Actor:worker-0-99edd64a-0fbf-4cda-a419-7d58a01bcbad] - Proxy call received: GET /client/menu
2025-12-25 13:39:55.015 [pool-6-thread-1] INFO  [com.saf.core1.ActorCell] [Actor:menu-router-27144093-f059-43e8-884f-ed3b8052ce1c] - RECEIVED message [ListMenu] Payload: ActorRef(ask-5a86ee1e-d95d-41f9-80c3-228e9bd47dcb-91d78019-0d9e-46cf-95dd-04cdfd262928)
2025-12-25 13:39:55.016 [pool-6-thread-1] INFO  [com.saf.core1.router.RoundRobinPool] [Actor:] - Pool size is now: 3
2025-12-25 13:39:55.016 [pool-6-thread-6] INFO  [com.saf.core1.ActorCell] [Actor:worker-0-3cc48499-5939-40a4-8912-0d890c180c20] - RECEIVED message [ListMenu] Payload: ActorRef(ask-5a86ee1e-d95d-41f9-80c3-228e9bd47dcb-91d78019-0d9e-46cf-95dd-04cdfd262928)
2025-12-25 13:39:55.017 [pool-6-thread-5] INFO  [com.saf.core1.ActorCell] [Actor:ask-5a86ee1e-d95d-41f9-80c3-228e9bd47dcb-91d78019-0d9e-46cf-95dd-04cdfd262928] - RECEIVED message [MenuListed] Payload: [MenuItem[dishName=burger, name=Burger maison, price=12.5, description=Pain brioché, boeuf, cheddar], MenuItem[dishName=salad, name=Salade fraîcheur, price=9.9, description=Légumes croquants], MenuItem[dishName=dessert, name=Mousse au chocolat, price=6.5, description=Chocolat noir 70%], MenuItem[dishName=drink, name=Limonade artisanale, price=4.0, description=Citron, menthe], MenuItem[dishName=coffee, name=Expresso, price=2.5, description=Arabica torréfié]]
2025-12-25 13:39:55.257 [pool-9-thread-1] INFO  [com.saf.core1.ActorCell] [Actor:] - RECEIVED message [ProxyCall] Payload: POST /client/orders
2025-12-25 13:39:55.258 [pool-9-thread-3] INFO  [com.saf.core1.ActorCell] [Actor:worker-1-6c435023-78d7-445d-af1b-13877a015426] - RECEIVED message [ProxyCall] Payload: POST /client/orders
2025-12-25 13:39:55.258 [pool-9-thread-3] INFO  [com.saf.client.ClientGatewayActor] [Actor:worker-1-6c435023-78d7-445d-af1b-13877a015426] - Proxy call received: POST /client/orders
2025-12-25 13:39:55.353 [pool-6-thread-9] INFO  [com.saf.core1.ActorCell] [Actor:client-1766666390470-f25b914e-ed10-4619-8658-90794e99d4b5] - RECEIVED message [BeginOrder] Payload: BeginOrder[]
2025-12-25 13:39:55.355 [pool-6-thread-4] INFO  [com.saf.core1.ActorCell] [Actor:restaurant-377a3a09-f2d9-415a-8155-97a6e606c55a] - RECEIVED message [OrderPlaced] Payload: OrderRequest[clientName=Alice, tableNumber=12, instructions=sans oignons, items=[OrderItem[dishName=burger, quantity=2], OrderItem[dishName=drink, quantity=2]]]
2025-12-25 13:39:55.359 [pool-6-thread-4] INFO  [c.s.r.actors.RestaurantActor] [Actor:restaurant-377a3a09-f2d9-415a-8155-97a6e606c55a] - Received order 1766666390470 from Alice
2025-12-25 13:39:55.360 [pool-6-thread-1] INFO  [com.saf.core1.ActorCell] [Actor:] - RECEIVED message [CalculatePrice] Payload: OrderRequest[clientName=Alice, tableNumber=12, instructions=sans oignons, items=[OrderItem[dishName=burger, quantity=2], OrderItem[dishName=drink, quantity=2]]]
2025-12-25 13:39:55.361 [pool-6-thread-7] INFO  [com.saf.core1.ActorCell] [Actor:worker-1-3638770c-35f5-499c-b476-e8aac8938ad4] - RECEIVED message [CalculatePrice] Payload: OrderRequest[clientName=Alice, tableNumber=12, instructions=sans oignons, items=[OrderItem[dishName=burger, quantity=2], OrderItem[dishName=drink, quantity=2]]]
2025-12-25 13:39:55.361 [pool-6-thread-4] INFO  [com.saf.core1.ActorCell] [Actor:restaurant-377a3a09-f2d9-415a-8155-97a6e606c55a] - RECEIVED message [PriceCalculated] Payload: PriceCalculated[orderId=1766666390470, valid=true, total=33.0, missingItems=[]]
2025-12-25 13:39:55.366 [pool-6-thread-9] INFO  [com.saf.core1.ActorCell] [Actor:client-1766666390470-f25b914e-ed10-4619-8658-90794e99d4b5] - RECEIVED message [AcknowledgeOrder] Payload: OrderAcknowledgement[orderId=1766666390470, status=PENDING_STOCK, message=Commande validée. Vérification du stock en cours., estimatedTotal=33.0, receipt=null]
2025-12-25 13:39:55.380 [pool-4-thread-1] INFO  [com.saf.core1.ActorCell] [Actor:stock-router-e5238651-77d2-4c8e-8c5a-8d073564b27d] - RECEIVED message [VerifyStock] Payload: com.InventoryService.InventoryService.dto.StockCheckRequest@610a842
2025-12-25 13:39:55.382 [pool-4-thread-1] INFO  [com.saf.core1.router.RoundRobinPool] [Actor:] - Pool size is now: 3
2025-12-25 13:39:55.382 [pool-4-thread-2] INFO  [com.saf.core1.ActorCell] [Actor:worker-0-75969cda-1af1-4564-af12-504265e75762] - RECEIVED message [VerifyStock] Payload: com.InventoryService.InventoryService.dto.StockCheckRequest@610a842
2025-12-25 13:39:55.382 [pool-4-thread-2] INFO  [c.I.I.actors.InventoryStockActor] [Actor:worker-0-75969cda-1af1-4564-af12-504265e75762] - Stock check start: orderId=1766666390470 items=[com.InventoryService.InventoryService.dto.StockCheckRequest$Item@2ac00ffa, com.InventoryService.InventoryService.dto.StockCheckRequest$Item@2407e4d2]
2025-12-25 13:39:55.387 [pool-6-thread-4] INFO  [c.s.r.client.InventoryClient] [Actor:restaurant-377a3a09-f2d9-415a-8155-97a6e606c55a] - Stock check request sent to inventory for order 1766666390470
2025-12-25 13:39:55.403 [pool-9-thread-1] INFO  [com.saf.core1.ActorCell] [Actor:] - RECEIVED message [ProxyCall] Payload: GET /client/receipts/1766666390470
2025-12-25 13:39:55.404 [pool-9-thread-4] INFO  [com.saf.core1.ActorCell] [Actor:worker-2-5963d7ec-7f5a-4fee-89a5-1a1e20a94cad] - RECEIVED message [ProxyCall] Payload: GET /client/receipts/1766666390470
2025-12-25 13:39:55.404 [pool-9-thread-4] INFO  [com.saf.client.ClientGatewayActor] [Actor:worker-2-5963d7ec-7f5a-4fee-89a5-1a1e20a94cad] - Proxy call received: GET /client/receipts/1766666390470
2025-12-25 13:39:55.565 [pool-4-thread-2] INFO  [c.I.I.actors.InventoryStockActor] [Actor:worker-0-75969cda-1af1-4564-af12-504265e75762] - Stock check result: orderId=1766666390470 success=true message=Stock reserved successfully
2025-12-25 13:39:55.581 [pool-4-thread-2] INFO  [c.I.I.client.InventoryCallbackClient] [Actor:worker-0-75969cda-1af1-4564-af12-504265e75762] - Callback envoyé vers http://localhost:37137/events/stock-result pour order 1766666390470
2025-12-25 13:39:55.578 [pool-6-thread-4] INFO  [com.saf.core1.ActorCell] [Actor:restaurant-377a3a09-f2d9-415a-8155-97a6e606c55a] - RECEIVED message [StockResult] Payload: StockResult[orderId=1766666390470, available=true, missingItems=[]]
2025-12-25 13:39:55.582 [pool-6-thread-2] INFO  [com.saf.core1.ActorCell] [Actor:treasury-f86ec934-1a7f-41df-9611-e22616cd8885] - RECEIVED message [RecordPayment] Payload: 33.0
2025-12-25 13:39:55.582 [pool-6-thread-3] INFO  [com.saf.core1.ActorCell] [Actor:receipt-bdfb62a7-d00a-4c28-8946-856b783952d1] - RECEIVED message [GenerateReceipt] Payload: OrderRequest[clientName=Alice, tableNumber=12, instructions=sans oignons, items=[OrderItem[dishName=burger, quantity=2], OrderItem[dishName=drink, quantity=2]]]
2025-12-25 13:39:55.643 [pool-6-thread-4] INFO  [com.saf.core1.ActorCell] [Actor:restaurant-377a3a09-f2d9-415a-8155-97a6e606c55a] - RECEIVED message [ReceiptReady] Payload: ReceiptDocument[orderId=1766666390470, clientName=Alice, tableNumber=12, total=33.0, items=[OrderItem[dishName=burger, quantity=2], OrderItem[dishName=drink, quantity=2]], issuedAt=2025-12-25T12:39:55.583466818Z, content==== SAF RESTAURANT RECEIPT ===
Client: Alice
Table: 12
Total: 33.0 €
Items:
- burger x 2
- drink x 2
]
2025-12-25 13:39:55.646 [pool-6-thread-9] INFO  [com.saf.core1.ActorCell] [Actor:client-1766666390470-f25b914e-ed10-4619-8658-90794e99d4b5] - RECEIVED message [AcknowledgeOrder] Payload: OrderAcknowledgement[orderId=1766666390470, status=COMPLETED, message=Commande servie et ticket généré., estimatedTotal=33.0, receipt==== SAF RESTAURANT RECEIPT ===
Client: Alice
Table: 12
Total: 33.0 €
Items:
- burger x 2
- drink x 2
]
2025-12-25 13:39:56.019 [pool-9-thread-1] INFO  [com.saf.core1.ActorCell] [Actor:] - RECEIVED message [ProxyCall] Payload: GET /client/receipts/1766666390470
2025-12-25 13:39:56.020 [pool-9-thread-2] INFO  [com.saf.core1.ActorCell] [Actor:worker-0-99edd64a-0fbf-4cda-a419-7d58a01bcbad] - RECEIVED message [ProxyCall] Payload: GET /client/receipts/1766666390470
2025-12-25 13:39:56.021 [pool-9-thread-2] INFO  [com.saf.client.ClientGatewayActor] [Actor:worker-0-99edd64a-0fbf-4cda-a419-7d58a01bcbad] - Proxy call received: GET /client/receipts/1766666390470
2025-12-25 13:39:56.094 [main] INFO  [com.zaxxer.hikari.HikariDataSource] [Actor:] - HikariPool-2 - Shutdown initiated...
2025-12-25 13:39:56.098 [main] INFO  [com.zaxxer.hikari.HikariDataSource] [Actor:] - HikariPool-2 - Shutdown completed.
2025-12-25 13:39:56.112 [main] INFO  [com.zaxxer.hikari.HikariDataSource] [Actor:] - HikariPool-1 - Shutdown initiated...
2025-12-25 13:39:56.116 [main] INFO  [com.zaxxer.hikari.HikariDataSource] [Actor:] - HikariPool-1 - Shutdown completed.
