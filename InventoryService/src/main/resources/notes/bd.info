-- 1. Create DB
CREATE DATABASE inventory_db;

-- 2. Create user
CREATE USER inventory_user WITH ENCRYPTED PASSWORD 'inventory_pass';

-- 3. Give privileges
GRANT ALL PRIVILEGES ON DATABASE inventory_db TO inventory_user;
ALTER DATABASE inventory_db OWNER TO inventory_user;

-- 4. Connect to DB
\c inventory_db;

-- 5. Schema permissions
GRANT ALL ON SCHEMA public TO inventory_user;

-- 6. Tables
CREATE TABLE IF NOT EXISTS ingredients (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    quantity INTEGER NOT NULL,
    unit VARCHAR(20) NOT NULL,
    threshold INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS recipes (
    id SERIAL PRIMARY KEY,
    dish_name VARCHAR(100) NOT NULL
);

CREATE TABLE IF NOT EXISTS recipe_items (
    id SERIAL PRIMARY KEY,
    recipe_id INTEGER NOT NULL REFERENCES recipes(id) ON DELETE CASCADE,
    ingredient_id INTEGER NOT NULL REFERENCES ingredients(id),
    quantity_needed INTEGER NOT NULL
);
